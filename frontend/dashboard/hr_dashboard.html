{% extends 'dashboard/base.html' %}

{% block content %}
{% load static %}

<style>
.dashboard-container {
  display: grid;
  grid-template-columns: 1fr 1fr;
  padding: 100px 45px;
  gap: 40px;
  animation: fadeUp 0.6s ease-out both;
}

.left {
  padding: 80px 0;
}

.left h1 {
  font-size: 36px;
  margin-bottom: 16px;
  animation: fadeUp 0.6s ease-out both;
  animation-delay: 0.1s;
}

.left p {
  color: #666;
  max-width: 420px;
  line-height: 1.6;
  animation: fadeUp 0.6s ease-out both;
  animation-delay: 0.2s;
}

.primary-btn {
  margin-top: 24px;
  padding: 12px 24px;
  border: none;
  border-radius: 10px;
  color: #fff;
  background: linear-gradient(135deg, #000, #333);
  box-shadow: 0 12px 30px rgba(0,0,0,0.2);
  cursor: pointer;
  animation: fadeUp 0.6s ease-out both;
  animation-delay: 0.3s;
  transition: all 0.25s ease;
}

.primary-btn:hover {
  transform: translateY(-2px);
  box-shadow: 0 18px 40px rgba(0,0,0,0.25);
}

.card-options {
  background: #fff;
  border-radius: 16px;
  padding: 28px;
  box-shadow: 0 10px 30px rgba(47, 128, 255, 0.25), 0 20px 60px rgba(0,0,0,0.08);
  transition: all 0.3s ease;
}

.card-options:hover {
  transform: translateY(-4px);
  box-shadow: 0 20px 50px rgba(47,128,255,0.35), 0 30px 80px rgba(0,0,0,0.12);
}

.card-options-header h3 {
  margin: 0;
}

.card-description {
  font-size: 14px;
  color: #666;
  margin: 0 0 20px;
  line-height: 1.5;
  animation: fadeUp 0.6s ease-out both;
}

/* === option 带图标 === */
.option {
  display: flex;
  align-items: center;
  gap: 16px;
  border: 1px solid #e5e7eb;
  border-radius: 12px;
  padding: 14px 16px;
  margin-bottom: 12px;
  cursor: pointer;
  transition: all 0.25s ease;
  text-decoration: none;
  color: #111;
}

.option-icon {
  width: 40px;
  height: 40px;
  flex-shrink: 0;
}

.option-icon img {
  width: 100%;
  height: 100%;
  object-fit: cover;
  border-radius: 8px;
}

.option-text h4 {
  margin: 0;
  font-size: 16px;
}

.option-text p {
  margin: 4px 0 0;
  font-size: 13px;
  color: #666;
}

.option:hover {
  background: #f5f9ff;
  border-color: #2f80ff;
  transform: translateY(-2px);
  box-shadow: 0 10px 25px rgba(47,128,255,0.15);
}

.option:active {
  transform: translateY(0);
  box-shadow: 0 6px 16px rgba(47,128,255,0.15);
}

.card {
  background: #fff;
  border-radius: 16px;
  padding: 24px;
  margin-top: 40px;
  box-shadow: 0 10px 30px rgba(47,128,255,0.12), 0 20px 60px rgba(0,0,0,0.05);
  transition: all 0.3s ease;
}

.card h2 {
  margin-top: 0;
  font-size: 20px;
  margin-bottom: 16px;
}

.card table {
  width: 100%;
  border-collapse: collapse;
  font-size: 14px;
  margin-top: 12px;
}

.card table th,
.card table td {
  border: 1px solid #e5e7eb;
  padding: 10px;
  text-align: left;
}

.card table th {
  background: #f5f7fa;
  font-weight: 600;
}

.card .btn {
  padding: 6px 12px;
  font-size: 13px;
  border-radius: 6px;
  border: 1px solid #ccc;
  background: #fff;
  cursor: pointer;
}

.card .btn-primary {
  background-color: #2f80ff;
  color: #fff;
  border: none;
}

.card .btn-danger {
  background-color: #dc3545;
  color: #fff;
  border: none;
}

.inline-form {
  display: inline-block;
}

.links a {
  margin-right: 15px;
  font-size: 14px;
  color: #2f80ff;
  text-decoration: none;
}

.status-active {
  color: green;
  font-weight: 500;
}

.status-inactive {
  color: red;
  font-weight: 500;
}

@keyframes fadeUp {
  from { opacity: 0; transform: translateY(20px); }
  to { opacity: 1; transform: translateY(0); }
}

</style>

<div class="dashboard-container">
  <section class="left">
    <h1>HR Dashboard</h1>
    <p>Welcome, <strong>{{ user.username }}</strong></p>
    <button class="primary-btn">Get Started</button>
  </section>

  <section class="right">
    <div class="card-options">
      <div class="card-options-header">
        <h3>Quick Actions</h3>
      </div>
      <p class="card-description">Choose your feature</p>

      <a href="{% url 'hr_dashboard' %}" class="option">
        <div class="option-icon">
          <img src="{% static 'assets/img/manage-trainings.png' %}" alt="Manage Trainings">
        </div>
        <div class="option-text">
          <h4>Manage Trainings</h4>
          <p>View and edit all trainings</p>
        </div>
      </a>

      <a href="{% url 'hr_training_registrations' %}" class="option">
        <div class="option-icon">
          <img src="{% static 'assets/img/training_registrations.png' %}" alt="Training Registration">
        </div>
        <div class="option-text">
          <h4>Training Registration</h4>
          <p>Register users for trainings</p>
        </div>
      </a>

      <a href="{% url 'attendance_summary' %}" class="option">
        <div class="option-icon">
          <img src="{% static 'assets/img/attendance_summary.png' %}" alt="Attendance Report">
        </div>
        <div class="option-text">
          <h4>View Attendance Report</h4>
          <p>Check user attendance status</p>
        </div>
      </a>

    </div>
  </section>
</div>

<!-- === 三个卡片保留并优化样式 === -->
<div class="card">
  <h2>Approve Pending Users</h2>
  <table>
    <tr>
      <th>Username</th>
      <th>Email</th>
      <th>Role</th>
      <th>Action</th>
    </tr>
    {% for profile in pending_users %}
    <tr>
      <td>{{ profile.user.username }}</td>
      <td>{{ profile.user.email }}</td>
      <td>{{ profile.role }}</td>
      <td>
        <form method="post" class="inline-form">{% csrf_token %}
          <input type="hidden" name="approve_id" value="{{ profile.user.id }}">
          <button type="submit" name="action" value="approve" class="btn btn-primary">Approve</button>
        </form>
        <form method="post" class="inline-form" onsubmit="return confirm('Are you sure you want to reject this user?');">{% csrf_token %}
          <input type="hidden" name="reject_id" value="{{ profile.user.id }}">
          <button type="submit" name="action" value="reject" class="btn btn-danger">Reject</button>
        </form>
      </td>
    </tr>
    {% empty %}
    <tr>
      <td colspan="4">No pending approvals</td>
    </tr>
    {% endfor %}
  </table>
</div>

<div class="card">
  <h2>Manage User Accounts</h2>
  <div class="links">
    <a href="{% url 'hr_create_user' %}">➕ Create New Account</a>
  </div>
  <table>
    <tr>
      <th>Username</th>
      <th>Email</th>
      <th>Role</th>
      <th>Department</th>
      <th>Status</th>
      <th>Actions</th>
    </tr>
    {% for u in all_users %}
    <tr>
      <td>{{ u.username }}</td>
      <td>{{ u.email }}</td>
      <td>{{ u.userprofile.role }}</td>
      <td>{% if u.userprofile.department %}{{ u.userprofile.department.name }}{% else %}-{% endif %}</td>
      <td>{% if u.is_active %}<span class="status-active">Active</span>{% else %}<span class="status-inactive">Deactivated</span>{% endif %}</td>
      <td>
        <a href="{% url 'hr_update_user' u.id %}">Edit</a>
        <form method="post" action="{% url 'hr_toggle_user' u.id %}" class="inline-form">{% csrf_token %}
          {% if u.is_active %}
            <button type="submit" class="btn">Deactivate</button>
          {% else %}
            <button type="submit" class="btn btn-primary">Activate</button>
          {% endif %}
        </form>
        <form method="post" action="{% url 'hr_delete_user' u.id %}" class="inline-form" onsubmit="return confirm('Are you sure you want to delete this user?');">{% csrf_token %}
          <button type="submit" class="btn btn-danger">Delete</button>
        </form>
      </td>
    </tr>
    {% endfor %}
  </table>
</div>

<div class="card">
  <h2>View Certificates</h2>
  <table>
    <tr>
      <th>User</th>
      <th>Training</th>
      <th>Issue Date</th>
      <th>Expiry Date</th>
      <th>Status</th>
      <th>Action</th>
    </tr>
    {% for cert in certificates %}
    <tr>
      <td>{{ cert.user.username }}</td>
      <td>{{ cert.training.title }}</td>
      <td>{{ cert.issue_date }}</td>
      <td>{{ cert.expiry_date }}</td>
      <td>{% if cert.is_expired %}<span class="status-inactive">Expired</span>{% else %}<span class="status-active">Valid</span>{% endif %}</td>
      <td>
        <form method="post" action="{% url 'hr_delete_certificate' cert.id %}" class="inline-form">{% csrf_token %}
          <button type="submit" class="btn btn-danger">Delete</button>
        </form>
      </td>
    </tr>
    {% empty %}
    <tr>
      <td colspan="6">No certificates found.</td>
    </tr>
    {% endfor %}
  </table>
</div>

{% endblock %}
