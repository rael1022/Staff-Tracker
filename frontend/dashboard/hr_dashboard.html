<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HR</title>
</head>
<body>
{% extends 'dashboard/base.html' %}

{% block content %}
<h1>HR Dashboard</h1>

<p>Welcome HR {{ user.username }}</p>

<h2>Approve pending</h2>
<table border="1">
    <tr>
        <th>Username</th>
        <th>Email</th>
        <th>Approve</th>
    </tr>
    {% for profile in pending_users %}
    <tr>
        <td>{{ profile.user.username }}</td>
        <td>{{ profile.user.email }}</td>
        <td>
            <form method="post">
                {% csrf_token %}
                <input type="hidden" name="approve_id" value="{{ profile.user.id }}">
                <button type="submit">Approve</button>
            </form>
        </td>
    </tr>
    {% empty %}
    <tr>
        <td colspan="3">No pending approvals</td>
    </tr>
    {% endfor %}
</table>

<h2>Manage User Accounts</h2>

<a href="{% url 'hr_create_user' %}">âž• Create New Account</a>

<table border="1">
    <tr>
        <th>Username</th>
        <th>Email</th>
        <th>Role</th>
        <th>Status</th>
        <th>Actions</th>
    </tr>

    {% for u in all_users %}
    <tr>
        <td>{{ u.username }}</td>
        <td>{{ u.email }}</td>
        <td>{{ u.userprofile.role }}</td>
        <td>
            {% if u.is_active %}Active{% else %}Deactivated{% endif %}
        </td>
        <td>
            <a href="{% url 'hr_update_user' u.id %}">Edit</a>

            <form method="post" action="{% url 'hr_toggle_user' u.id %}" style="display:inline;">
                {% csrf_token %}
                {% if u.is_active %}
                    <button type="submit">Deactivate</button>
                {% else %}
                    <button type="submit">Activate</button>
                {% endif %}
            </form>
        </td>
    </tr>
    {% endfor %}
</table>

<a href="{% url 'hr_dashboard' %}">Manage Trainings</a>

<a href="{% url 'hr_training_registrations' %}">Training Registration</a>

<a href="{% url 'attendance_summary' %}">View Attendence report</a>

<!-- Certificate Management -->
<h2 class="text-xl mt-6 mb-2">Manage Certificates</h2>
<table class="table-auto w-full border-collapse border border-gray-300">
    <thead>
        <tr class="bg-gray-200">
            <th class="border px-2 py-1">User</th>
            <th class="border px-2 py-1">Training</th>
            <th class="border px-2 py-1">Issue Date</th>
            <th class="border px-2 py-1">Expiry Date</th>
            <th class="border px-2 py-1">Status</th>
            <th class="border px-2 py-1">Actions</th>
        </tr>
    </thead>
    <tbody>
        {% for cert in certificates %}
        <tr>
            <td class="border px-2 py-1">{{ cert.user.username }}</td>
            <td class="border px-2 py-1">{{ cert.training.title }}</td>
            <td class="border px-2 py-1">{{ cert.issue_date }}</td>
            <td class="border px-2 py-1">{{ cert.expiry_date }}</td>
            <td class="border px-2 py-1">
                {% if cert.is_expired %}
                    <span class="text-red-600">Expired</span>
                {% else %}
                    <span class="text-green-600">Valid</span>
                {% endif %}
            </td>
            <td class="border px-2 py-1">
                <form method="post" action="{% url 'hr_delete_certificate' cert.id %}">
                    {% csrf_token %}
                    <button type="submit" class="text-red-600">Delete</button>
                </form>
            </td>
        </tr>
        {% empty %}
        <tr>
            <td colspan="6" class="text-center py-1">No certificates found.</td>
        </tr>
        {% endfor %}
    </tbody>
</table>

{% endblock %}
</body>
</html>
