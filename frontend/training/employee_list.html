{% extends 'dashboard/base.html' %}

{% block content %}

<style>
h2 {
    font-size: 24px;
    font-weight: bold;
    margin-bottom: 20px;
    text-align: center;
}

.filter-card {
    background: #f9fafc;
    padding: 20px 25px;
    border-radius: 8px;
    box-shadow: 0 2px 6px rgba(0,0,0,0.05);
    max-width: 900px;
    margin: 0 auto 20px auto;
}

.filter-card h3 {
    font-size: 18px;
    font-weight: 600;
    text-align: center;
    margin-bottom: 15px;
    color: #333;
}

.filter-form {
    display: flex;
    flex-wrap: wrap;
    gap: 15px;
    justify-content: space-between;
    align-items: flex-end;
}

.filter-group {
    flex: 1 1 200px;
    display: flex;
    flex-direction: column;
}

.filter-group label {
    font-size: 13px;
    font-weight: 500;
    margin-bottom: 5px;
    color: #555;
}

.filter-group input[type="date"] {
    padding: 7px 10px;
    font-size: 14px;
    border: 1px solid #ccc;
    border-radius: 6px;
    width: 100%;
    box-sizing: border-box;
}

.filter-actions {
    display: flex;
    gap: 10px;
    flex: 1 1 100%;
    justify-content: center;
    margin-top: 10px;
}

.btn {
    padding: 8px 16px;
    font-size: 14px;
    border-radius: 6px;
    text-decoration: none;
    border: none;
    cursor: pointer;
    display: inline-block;
}

.btn-primary {
    background-color: #007bff;
    color: #fff;
}

.btn-primary:hover {
    background-color: #0056b3;
}

.btn-secondary {
    background-color: #6c757d;
    color: #fff;
}

.btn-secondary:hover {
    background-color: #565e64;
}

.card {
    background: #fff;
    padding: 20px;
    border-radius: 8px;
    box-shadow: 0 2px 6px rgba(0,0,0,0.08);
}

table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 10px;
}

th, td {
    border: 1px solid #ddd;
    padding: 10px;
    font-size: 14px;
    text-align: left;
}

th {
    background-color: #f2f4f7;
    font-weight: 600;
}

.status {
    font-weight: 500;
}

.status-pending {
    color: #ff9800;
}

.status-approved {
    color: green;
}

.status-rejected {
    color: red;
}

.btn-register {
    display: inline-block;
    padding: 6px 14px;
    font-size: 13px;
    font-weight: 500;
    color: #fff;
    background-color: #007bff;
    border-radius: 4px;
    text-decoration: none;
}

.btn-register:hover {
    background-color: #0056b3;
}

@media (max-width: 700px) {
    .filter-form {
        flex-direction: column;
    }
    .filter-actions {
        justify-content: center;
    }
}
</style>

<h2>Available Trainings</h2>

<div class="filter-card">
    <h3>Filter Trainings</h3>
    <form method="get" class="filter-form">
        <div class="filter-group">
            <label for="start_date">Start Date</label>
            <input type="date" name="start_date" id="start_date" value="{{ start_date }}">
        </div>

        <div class="filter-group">
            <label for="end_date">End Date</label>
            <input type="date" name="end_date" id="end_date" value="{{ end_date }}">
        </div>

        <div class="filter-actions">
            <button type="submit" class="btn btn-primary">Filter</button>
            <a href="{% url 'employee_dashboard' %}" class="btn btn-secondary">Reset</a>
        </div>
    </form>
</div>

<div class="card">
    <table>
        <thead>
            <tr>
                <th>Title</th>
                <th>Date</th>
                <th>Time</th>
                <th>Duration (hours)</th>
                <th>Location</th>
                <th>CPD Points</th>
                <th>Status</th>
                <th>Assessment</th>
                <th>Evaluation</th>
            </tr>
        </thead>
        <tbody>
            {% load training_tags %}
            {% for training in trainings %}
            <tr>
                <td>{{ training.title }}</td>
                <td>{{ training.date }}</td>
                <td>{{ training.time }}</td>
                <td>{{ training.duration_hours }}</td>
                <td>{{ training.location }}</td>
                <td>{{ training.cpd_points }}</td>
                <td>
                    {% with reg=registrations|get_training_registration:training.id %}
                        {% if reg %}
                            <span class="status
                                {% if reg.status == 'Pending' %}status-pending
                                {% elif reg.status == 'Approved' %}status-approved
                                {% elif reg.status == 'Rejected' %}status-rejected
                                {% endif %}
                            ">
                                {{ reg.status }}
                            </span>
                        {% else %}
                        <a href="{% url 'register_training' training.id %}" class="btn-register">
                            Register
                        </a>
                        {% endif %}
                    {% endwith %}
                </td>
                <td>
                    {% with reg=registrations|get_training_registration:training.id %}
                        {% if reg and reg.status == 'Approved' %}
                            <a href="{% url 'pre_assessment' training_id=training.id %}">Pre-Assessment</a>
                            {% if training.is_completed %}
                                <br>
                                <a href="{% url 'post_assessment' training_id=training.id %}">Post-Assessment</a>
                            {% endif %}
                        {% endif %}
                    {% endwith %}
                </td>
                <td>
                    {% with reg=registrations|get_training_registration:training.id %}
                        {% if reg and reg.status == 'Approved' %}
                            {% if not training.has_evaluated %}
                                {% if training.status == 'Complete' %}
                                    <a href="{% url 'submit_evaluation' training.id %}" class="btn btn-primary btn-sm">
                                        Evaluate
                                    </a>
                                {% else %}
                                    <span class="text-muted">Training Not Completed</span>
                                {% endif %}
                            {% else %}
                                <span class="text-success">âœ“ Evaluated</span>
                            {% endif %}
                        {% else %}
                            <span class="text-muted">Not Eligible</span>
                        {% endif %}
                    {% endwith %}
                </td>
            </tr>
            {% empty %}
            <tr>
                <td colspan="9">No trainings available.</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

{% endblock %}
